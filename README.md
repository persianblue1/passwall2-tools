# ابزارهای مسیریابی و بکاپ Passwall2 🇮🇷

اسکریپت‌های خودکار برای تنظیم مسیریابی هوشمند در Passwall2، آپدیت امن پایگاه‌های GeoIP/GeoSite، و بکاپ‌گیری/بازگردانی تنظیمات روی OpenWrt.

---

## 📦 فایل‌ها

| نام فایل | توضیح |
|----------|-------|
| `setup_passwall2_with_safe_updates_and_backup.sh` | تنظیم قوانین ایران + دانلود امن GeoIP/GeoSite + بکاپ‌گیری روزانه |
| `restore_passwall2_backup.sh` | بازگردانی بکاپ با منوی انتخابی از آخرین نسخه‌های ذخیره‌شده |

---

## ⚙️ نحوه اجرا

### ۱. اجرای اسکریپت تنظیم اولیه

```bash
sh setup_passwall2_with_safe_updates_and_backup.sh
این اسکریپت:

تنظیم قوانین مسیریابی برای IPها و دامنه‌های ایرانی

دانلود پایگاه‌های GeoIP و GeoSite از منبع معتبر

بکاپ‌گیری از تنظیمات و دیتابیس‌ها

افزودن کران‌جاب روزانه برای آپدیت و بکاپ‌گیری خودکار

نگه‌داری فقط ۱۰ بکاپ آخر برای صرفه‌جویی در فضا

مسیر بکاپ‌ها: /root/passwall2_backups/ مسیر دیتابیس‌ها: /usr/share/passwall2/

🔁 بازگردانی بکاپ
برای بازگردانی یکی از بکاپ‌های قبلی:

bash
sh restore_passwall2_backup.sh
سپس لیستی از بکاپ‌های موجود نمایش داده می‌شود. با وارد کردن شماره، تنظیمات و دیتابیس‌ها بازگردانی شده و سرویس Passwall2 ری‌استارت می‌شود.

🧠 نکات مهم
اگر دانلود GeoIP یا GeoSite ناموفق باشد، نسخهٔ قبلی حفظ می‌شود تا سرویس قطع نشود.

قوانین زیر برای ترافیک ایران به‌صورت مستقیم تنظیم می‌شوند:

IPهای ایران (GeoIP)

دامنه‌های ایرانی (GeoSite)

دامنه‌هایی با پسوند .ir (Regex)

باقی ترافیک از طریق نود پیش‌فرض (مثلاً VPN) هدایت می‌شود.

📜 پیش‌نیازها
OpenWrt با نصب luci-app-passwall2

فعال بودن سرویس passwall2

دسترسی root برای اجرای اسکریپت‌ها

نصب curl و tar (در اکثر نسخه‌های OpenWrt موجود است)

🧰 توسعه‌دهنده
GitHub: persianblue1

مخزن: passwall-routing-and-backup

📬 پیشنهاد یا مشکل؟
اگر پیشنهادی برای بهبود اسکریپت‌ها یا مشکلی در اجرا دارید، لطفاً در بخش Issues همین مخزن مطرح
